{"paragraphs":[{"title":"Create new schema as required in the especification","text":"%spark\n\n// First, import the Spark SQL types\nimport org.apache.spark.sql.types._\n\n// Then specify the schema as a `StructType` instance: \nval schemaElectricityConsumption = StructType(Array(\n                                    StructField(\"cups\", StringType, nullable = false),\n                                    StructField(\"finicio\", DateType, nullable = false),\n                                    StructField(\"ffin\", DateType, nullable = false),\n                                    StructField(\"tarifa\", StringType, false),\n                                    StructField(\"consumoactivap1\", FloatType, nullable = false),\n                                    StructField(\"consumoactivap2\", FloatType, false),\n                                    StructField(\"consumoactivap3\", FloatType, false),\n                                    StructField(\"consumoactivap4\", FloatType, false),\n                                    StructField(\"consumoactivap5\", FloatType, false),\n                                    StructField(\"consumoactivap6\", FloatType, false),\n                                    StructField(\"consumoreactivap1\", FloatType, false),\n                                    StructField(\"consumoreactivap2\", FloatType, false),\n                                    StructField(\"consumoreactivap3\", FloatType, false),\n                                    StructField(\"consumoreactivap4\", FloatType, false),\n                                    StructField(\"consumoreactivap5\", FloatType, false),\n                                    StructField(\"consumoreactivap6\", FloatType, false),\n                                    StructField(\"potmaxp1\", FloatType, true),\n                                    StructField(\"potmaxp2\", FloatType, true),\n                                    StructField(\"potmaxp3\", FloatType, true),\n                                    StructField(\"potmaxp4\", FloatType, true),\n                                    StructField(\"potmaxp5\", FloatType, true),\n                                    StructField(\"potmaxp6\", FloatType, true),\n                                    StructField(\"numdias\", IntegerType, true),\n                                    StructField(\"cmd\", FloatType, true)\n))\n\nval electricityConsumption = (spark.read\n                                    .format(\"csv\")\n                                    .option(\"sep\", \",\")\n                                    .option(\"header\", \"true\")\n                                    .schema(schemaElectricityConsumption)\n                                    .load(\"/user/azahara/raw/CNMC/201712_SIPS2_CONSUMOS_ELECTRICIDAD_nacional.csv\"))\n                                    \nelectricityConsumption.show()","user":"anonymous","dateUpdated":"2023-05-21T07:22:20+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","title":true,"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.types._\nschemaElectricityConsumption: org.apache.spark.sql.types.StructType = StructType(StructField(cups,StringType,false), StructField(finicio,DateType,false), StructField(ffin,DateType,false), StructField(tarifa,StringType,false), StructField(consumoactivap1,FloatType,false), StructField(consumoactivap2,FloatType,false), StructField(consumoactivap3,FloatType,false), StructField(consumoactivap4,FloatType,false), StructField(consumoactivap5,FloatType,false), StructField(consumoactivap6,FloatType,false), StructField(consumoreactivap1,FloatType,false), StructField(consumoreactivap2,FloatType,false), StructField(consumoreactivap3,FloatType,false), StructField(consumoreactivap4,FloatType,false), StructField(consumoreactivap5,FloatType,false), StructField(consumoreactivap6,FloatType,false), StructF...electricityConsumption: org.apache.spark.sql.DataFrame = [cups: string, finicio: date ... 22 more fields]\n+--------------------+----------+----------+------+---------------+---------------+---------------+---------------+---------------+---------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+--------+--------+--------+--------+--------+--------+-------+----+\n|                cups|   finicio|      ffin|tarifa|consumoactivap1|consumoactivap2|consumoactivap3|consumoactivap4|consumoactivap5|consumoactivap6|consumoreactivap1|consumoreactivap2|consumoreactivap3|consumoreactivap4|consumoreactivap5|consumoreactivap6|potmaxp1|potmaxp2|potmaxp3|potmaxp4|potmaxp5|potmaxp6|numdias| cmd|\n+--------------------+----------+----------+------+---------------+---------------+---------------+---------------+---------------+---------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+--------+--------+--------+--------+--------+--------+-------+----+\n|ES0480100000003616HB|2017-08-31|2017-10-31|   001|            0.0|        83000.0|            0.0|            0.0|            0.0|            0.0|              0.0|              0.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480100000003616HB|2017-06-30|2017-08-31|   001|            0.0|       190000.0|            0.0|            0.0|            0.0|            0.0|              0.0|              0.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480100000003616HB|2017-04-30|2017-06-30|   001|            0.0|       588000.0|            0.0|            0.0|            0.0|            0.0|              0.0|              0.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480100000003616HB|2017-02-28|2017-04-30|   001|            0.0|            0.0|            0.0|            0.0|            0.0|            0.0|              0.0|              0.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480100000003616HB|2016-12-31|2017-02-28|   001|            0.0|        18000.0|            0.0|            0.0|            0.0|            0.0|              0.0|              0.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480100000003616HB|2016-10-31|2016-12-31|   001|            0.0|        47000.0|            0.0|            0.0|            0.0|            0.0|              0.0|              0.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480100000003616HB|2016-08-31|2016-10-31|   001|            0.0|        79000.0|            0.0|            0.0|            0.0|            0.0|              0.0|              0.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480100000003616HB|2016-06-30|2016-08-31|   001|            0.0|       518000.0|            0.0|            0.0|            0.0|            0.0|              0.0|              0.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480100000003616HB|2016-04-30|2016-06-30|   001|            0.0|            0.0|            0.0|            0.0|            0.0|            0.0|              0.0|              0.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480100000003616HB|2016-02-29|2016-04-30|   001|            0.0|            0.0|            0.0|            0.0|            0.0|            0.0|              0.0|              0.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480100000003616HB|2015-12-31|2016-02-29|   001|            0.0|       106000.0|            0.0|            0.0|            0.0|            0.0|              0.0|              0.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480100000003616HB|2015-10-31|2015-12-31|   001|            0.0|       115000.0|            0.0|            0.0|            0.0|            0.0|              0.0|              0.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480000054001699VY|2017-08-31|2017-10-31|   001|            0.0|        54000.0|            0.0|            0.0|            0.0|            0.0|              0.0|          29000.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480000054001699VY|2017-07-01|2017-08-31|   001|            0.0|       160000.0|            0.0|            0.0|            0.0|            0.0|              0.0|          34000.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480000054001699VY|2017-04-30|2017-06-30|   001|            0.0|        37000.0|            0.0|            0.0|            0.0|            0.0|              0.0|          27000.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480000054001699VY|2017-02-28|2017-04-30|   001|            0.0|        84000.0|            0.0|            0.0|            0.0|            0.0|              0.0|          29000.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480000054001699VY|2016-12-31|2017-02-28|   001|            0.0|        85000.0|            0.0|            0.0|            0.0|            0.0|              0.0|          32000.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480000054001699VY|2016-10-31|2016-12-31|   001|            0.0|        43000.0|            0.0|            0.0|            0.0|            0.0|              0.0|          31000.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480000054001699VY|2016-08-31|2016-10-31|   001|            0.0|        62000.0|            0.0|            0.0|            0.0|            0.0|              0.0|          33000.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n|ES0480000054001699VY|2016-06-30|2016-08-31|   001|            0.0|       156000.0|            0.0|            0.0|            0.0|            0.0|              0.0|          34000.0|              0.0|              0.0|              0.0|              0.0|     0.0|     0.0|     0.0|     0.0|     0.0|     0.0|   null|null|\n+--------------------+----------+----------+------+---------------+---------------+---------------+---------------+---------------+---------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+--------+--------+--------+--------+--------+--------+-------+----+\nonly showing top 20 rows"}]},"apps":[],"jobName":"paragraph_1684425540972_55387925","id":"20230518-175900_413068431","dateCreated":"2023-05-18T17:59:00+0200","dateStarted":"2023-05-20T09:37:22+0200","dateFinished":"2023-05-20T09:38:05+0200","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1172"},{"title":"Create colum numdias (ffin-finicio) and cmd (sum(active power) /numdias)","text":"%spark\nval electricityConsumptionMod= {electricityConsumption\n                                    .withColumn(\"numdias\", datediff(col(\"ffin\"), col(\"finicio\")))\n                                    .withColumn(\"cmd\", (col(\"consumoactivap1\")+ col(\"consumoactivap2\")+ col(\"consumoactivap3\") + col(\"consumoactivap4\") + col(\"consumoactivap5\") + col(\"consumoactivap6\"))/col(\"numdias\"))}\n                                    \n","user":"anonymous","dateUpdated":"2023-05-20T09:43:31+0200","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala","tableHide":true,"title":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"electricityConsumptionMod: org.apache.spark.sql.DataFrame = [cups: string, finicio: date ... 22 more fields]"}]},"apps":[],"jobName":"paragraph_1684390612706_-535571790","id":"20230518-081652_634313467","dateCreated":"2023-05-18T08:16:52+0200","dateStarted":"2023-05-20T09:38:12+0200","dateFinished":"2023-05-20T09:38:13+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1173"},{"title":"Convert to parquet","text":"%spark\n\nval SIPSCOPath = \"/user/azahara/refined/CNMC/201712_SIPS2_CONSUMOS_ELECTRICIDAD_nacional\"\n\nelectricityConsumptionMod.write.mode(\"overwrite\").parquet(SIPSCOPath)\n","user":"anonymous","dateUpdated":"2023-05-20T09:43:31+0200","config":{"tableHide":true,"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"SIPSCOPath: String = /user/azahara/refined/CNMC/201712_SIPS2_CONSUMOS_ELECTRICIDAD_nacional"}]},"apps":[],"jobName":"paragraph_1684347167926_-1610380598","id":"20230515-175301_689482824","dateCreated":"2023-05-17T20:12:47+0200","dateStarted":"2023-05-20T09:39:06+0200","dateFinished":"2023-05-20T09:39:21+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1174"},{"title":"Showing modified schema","text":"%spark\nval dataFrameFromParquet = spark.read.parquet(\"/user/azahara/refined/CNMC/201712_SIPS2_CONSUMOS_ELECTRICIDAD_nacional\")\n\ndataFrameFromParquet.printSchema()","user":"anonymous","dateUpdated":"2023-05-21T07:22:52+0200","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"title":true,"results":{},"enabled":true,"tableHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"dataFrameFromParquet: org.apache.spark.sql.DataFrame = [cups: string, finicio: date ... 22 more fields]\nroot\n |-- cups: string (nullable = true)\n |-- finicio: date (nullable = true)\n |-- ffin: date (nullable = true)\n |-- tarifa: string (nullable = true)\n |-- consumoactivap1: float (nullable = true)\n |-- consumoactivap2: float (nullable = true)\n |-- consumoactivap3: float (nullable = true)\n |-- consumoactivap4: float (nullable = true)\n |-- consumoactivap5: float (nullable = true)\n |-- consumoactivap6: float (nullable = true)\n |-- consumoreactivap1: float (nullable = true)\n |-- consumoreactivap2: float (nullable = true)\n |-- consumoreactivap3: float (nullable = true)\n |-- consumoreactivap4: float (nullable = true)\n |-- consumoreactivap5: float (nullable = true)\n |-- consumoreactivap6: float (nullable = true)\n |-- potmaxp1: float (nullable = true)\n |-- potmaxp2: float (nullable = true)\n |-- potmaxp3: float (nullable = true)\n |-- potmaxp4: float (nullable = true)\n |-- potmaxp5: float (nullable = true)\n |-- potmaxp6: float (nullable = true)\n |-- numdias: integer (nullable = true)\n |-- cmd: double (nullable = true)"}]},"apps":[],"jobName":"paragraph_1684347167929_-1523481389","id":"20230517-195515_1332964914","dateCreated":"2023-05-17T20:12:47+0200","dateStarted":"2023-05-20T09:39:26+0200","dateFinished":"2023-05-20T09:39:28+0200","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1175"}],"name":"SILVER LAYER/ETL CNMC_Consumption","id":"2J36P7APV","noteParams":{},"noteForms":{},"angularObjects":{"sh:shared_process":[],"livy:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}